
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-73216650-1', 'auto');
ga('set', {
  page: '/documentation/1.4.0/user_guide/services_management.html',
  title: 'Services management'
});
ga('send', 'pageview');

</script>

<div class="container-fluid">
  <div class="row">
    
      <div class="col-sm-4 col-md-3">
        <div id="sidebar_menu" class="tree" role="complementary"></div>
      </div>
      <div id="content" class="col-sm-8 col-md-9">
    
        <div style="height: 50px;">
          <h1 class="pull-left" style="margin-top: 0px;">Services management</h1>
          <a class="btn btn-primary pull-right" href="http://prose.io/#alien4cloud/alien4cloud.github.io/edit/sources/documentation/1.4.0/user_guide/services_management.md"><i class="fa fa-pencil-square-o"></i> Edit (pull request)</a>
        </div>
        
<hr style="margin-top:5px; margin-bottom:5px;" />
<div class="row"><ul class="nav nav-pills" id="summarypanel"></ul></div>
<hr style="margin-top:5px; margin-bottom:5px;" />

<p><em>Section in progress…</em></p>

<p>Services in alien4cloud design any already running resource (databases, application providing an API etc.) that can be used by the applications through matching of abstract nodes (just like on demand resources).</p>

<p>The fundamental difference between service and on-demand resource is the ownership of the resource lifecycle. While on-demand resources lifecycle is managed by the consuming application, services are elements external to the application but yet consumed by the application.</p>

<p>For example you may have an on-demand database, which will be created when you deploy the application and (eventually) deleted when the application will be un-deployed.</p>

<p>When using a service you expect someone else to start the service (either externally to alien4cloud or through an alien deployment) and just consume it. In any case you will not be the owner of the service lifecycle.</p>

<div class="note warning">
<h5>Limitation</h5>
<p>On a topology, a service can expose multiple endpoints but only 1 endpoint can be used otherwise relationship operations won’t be called properly.</p>

<h5>Workaround</h5>
<p>Add the service node multiple time into your topology then use only 1 endpoint by abstract service node (each service node will be connected to the same service).</p>
</div>

<h1 id="referencing-external-services-in-alien4cloud">Referencing external services in alien4cloud</h1>

<p>The first method to define a service in alien4cloud is to declare manually a service. In order to do this, click on <em>[Administration]</em> &gt; <em>Service</em></p>

<p><img src="../../images/1.4.0/user_guide/service/service_list.png" alt="service_list" /></p>

<p>Let’s say you have a Mongodb database that you want to expose to other applications, you can drag the component <code>mongod-type</code> and drop it on the demarcated zone on the left to create the service Mongo. It’s not shown in the image but <code>mongod-type</code> derived from <code>AbstractMongod</code></p>

<p><img src="../../images/1.4.0/user_guide/service/create_external_service.png" alt="create_external_service" /></p>

<p>After the creation, the service appears on the left hand side list and can be configured.</p>

<p><img src="../../images/1.4.0/user_guide/service/service_list_with_external_mongo.png" alt="service_list_with_external_mongo" /></p>

<p>Click on the service to see its details. Here the status does not have much sense, a service in enabled state cannot be modified and deleted (it will make more sense with a service exposed by a deployment as Alien4Cloud knows the state of the service).</p>

<p><img src="../../images/1.4.0/user_guide/service/service_detail.png" alt="service_detail" /></p>

<p>The instance tab gives you access to properties and attributes of your service. The properties and attributes values, that you enter here, can be used later by consumer of the service to establish the connection with the service. In the example, the property <code>ip_address</code> of the external Mongo DB has been given.</p>

<div class="note info">
<h5>IP Address</h5>
<p>When a service is not managed by A4C you need to define manually how to access the service (i.e. the IP address)</p>
</div>

<div class="note warning">
<h5>Limitation</h5>
<p>A4C 1.4 does not support capabilitie attributes edition yet. Thus, sadly you cannot define the endpoint ip_address on the endpoint itself.</p>

<p>You need to add an attribute on the service node type level following the naming convention: <code>capabilities.YOUR_CAPABILITY_NAME.ATTRIBUTE_KEY</code>.</p>

<p>For example in our case of Mongo service, we would define the capability <code>service_api</code> attribute <code>ip_address</code> like this:</p>

<p><img src="../../images/1.4.0/user_guide/service/user_attributes.png" alt="defining_capabilities_attributes_for_service" /></p>
</div>

<p>The location tab permits to authorize service access to locations. It means only application deployed on the authorized locations can have access to the service.</p>

<p><img src="../../images/1.4.0/user_guide/service/service_location.png" alt="service_location" /></p>

<p>The security tab permits to authorize service access to application / environment / user or group. Only authorized entity has access to the location.</p>

<p><img src="../../images/1.4.0/user_guide/service/service_security.png" alt="service_security" /></p>

<p>Once the service has been properly defined, authorization has been properly configured. You can begin to consume it with your application. As you can see, the example use the abstract type <code>AbstractMongod</code> which is the base type that was used to define the service.</p>

<p><img src="../../images/1.4.0/user_guide/service/service_consumption.png" alt="service_consumption" /></p>

<p>On matching screen, your AbstractMongod will be matched to the service that has been defined lately</p>

<p><img src="../../images/1.4.0/user_guide/service/service_matching.png" alt="service_matching" /></p>

<h1 id="turning-deployments-into-services">Turning deployments into services</h1>

<p>Turning deployments into services is usually done by the deployment manager of the application environment.</p>

<p>Service definition within Alien4Cloud uses substitution in order to expose properties, requirements or capabilities.<br />
The first thing you need to do is to define your service topology, and a substitution for it</p>

<p><img src="../../images/1.4.0/user_guide/service/service_topology.png" alt="service_topology" /></p>

<p>Once the service topology is done, you can set up an environment to be deployed on your chosen location.<br />
Before deploying, you can choose to expose your deployment as a service in the <em>Service management</em> section</p>

<p><img src="../../images/1.4.0/user_guide/service/service_exposition.png" alt="service_exposition" /></p>

<p>As an admin, the service exposed will be displayed automatically in the service list <em>[Administration]</em> &gt; <em>Service</em></p>

<p><img src="../../images/1.4.0/user_guide/service/service_list_with_exposed_mongo.png" alt="service_list_with_exposed_mongo" /></p>

<p>Once the service is exposed, access to the service, the matching can be configured in the same manner as an external service.<br />
However, note that the exosed services are automatically available on the location selected for the deployment once deployed.  </p>

<h1 id="limitations">Limitations</h1>

<ul>
  <li>Services substitution does not yet supports the exposure of multiple instances. Output properties cannot reference properties of scaled instances.</li>
  <li>Input properties are used both for topology input and deployment inputs. Users should handle connection to services using capabilities only properties/attributes and eventually node attributes but not node properties.</li>
</ul>

<div class="note warning">
<h5>Snapshot versions</h5>
<p>While creation of services out of snapshot types is possible it is not recommended for two reasons.</p>

<ul>
  <li>The first one is that we believe that it is not a good practice to interact with other teams based on unstable features.</li>
  <li>The second is that alien4cloud may not handle node type updates correctly and such usage is done at your own risks.</li>
</ul>

</div>

<h1 id="example">Example</h1>

<p>The MongoDB service example in the two sections above <a href="https://github.com/alien4cloud/samples/tree/master/mongo">can be found here</a>. It comes with a topology template <em>mongod-type</em> that defines a simple topology containing a MongoDB hosted on a Compute. This template is exposed as a type named <em>mongod-type</em> using substitution exposition.</p>

<p>The node cellar application, which consumes the service, <a href="https://github.com/alien4cloud/samples/tree/master/topology-nodecellar-service">can be found here</a>. In the topology template <em>Nodecellar-ClientService</em>, the abstract node <em>alien.nodes.AbstractMongod</em> was matched to the MongoDB service.</p>

<h1 id="advanced">Advanced</h1>

<h2 id="relationship-and-service">Relationship and service</h2>

<p><strong>TLDR;</strong> When a relationship is involving a service, think “half relationship”, one half relationship is managing the source side, and the other one the target side.</p>

<p>Services are running resources managed by third parties, as such only the third party is authorized to manage the service settings.
In order to protect the integrity of: services, service consumers and service providers, we cannot let everybody alters a service and vice versa.
Only operations defined by the owner can be executed on it.</p>

<p>For example: a service consumer is not allowed to execute operations on the service side.</p>

<p>In Tosca, the source of the relatonship is responsible to define operations executed on both side (source and target), this is a problem when a service is involved.
The solution chosen by A4C is to:</p>

<ul>
  <li>let the administrator configures the source with one relationship that holds all the operations impacting the source and another one for the target with operations that will impact the target.</li>
  <li>not execute any operations impacting a side we don’t manage</li>
</ul>

<p>When a service is involved, a relationship should be seen as a half relationship.
One part of the relationship is defined by the consumer and the other part by the provider. At runtime the 2 relationships are merged into 1.</p>

<h2 id="how-to-define-relationships-on-the-service-side">How to define relationships on the service side</h2>

<p>Depending if the service is a consumer or a provider you will need to add a <em>half</em> relationship on a service capability or a service requirement.</p>

<p>In the case of the MongoDB service described above we need to add the relationship to the <em>“database_endpoint”</em> capability.</p>

<p>Let’s say we’d like to run a script everytime a new consumer is added.
For that we need to create a relationship dedicated to the service side:</p>

<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">tosca_definitions_version</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">alien_dsl_1_3_0</span>
<span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">A relationship definition for the service side</span>
<span class="l-Scalar-Plain">template_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">mongo_db_relaitonship_service_side</span>
<span class="l-Scalar-Plain">template_version</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">0.1.0-SNAPSHOT</span>
<span class="l-Scalar-Plain">template_author</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">admin</span>

<span class="l-Scalar-Plain">imports</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">tosca-normative-types:1.0.0-ALIEN12</span>

<span class="l-Scalar-Plain">relationship_types</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">org.alien4cloud.relationships.NodejsConnectToMongoServiceSide</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">derived_from</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">tosca.relationships.ConnectsTo</span>
        <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Relationship use to define operations run on the mongo side</span>
        <span class="l-Scalar-Plain">interfaces</span><span class="p-Indicator">:</span>
          <span class="l-Scalar-Plain">Configure</span><span class="p-Indicator">:</span>
              <span class="l-Scalar-Plain">add_source</span><span class="p-Indicator">:</span>
                  <span class="l-Scalar-Plain">implementation</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">scripts/when_new_source.sh</span></code></pre></div>

<p>And upload this yaml as we would do if it was a component.</p>

<p>Then attach the NodejsConnectToMongoServiceSide to the service capability <em>“database_endpoint”</em>:</p>

<p><img src="../../images/1.4.0/user_guide/service/service_mongodb_relationship.png" alt="service_list" /></p>

<p>And that’s it.</p>

        <a class="btn btn-primary pull-right" href="http://prose.io/#alien4cloud/alien4cloud.github.io/edit/sources/documentation/1.4.0/user_guide/services_management.md"><i class="fa fa-pencil-square-o"></i> Edit (pull request)</a>
	  </div>
    </div>
  </div>
</div><!-- /container -->

<script>
var hash = location.hash.replace( /^#/, '' );
if(hash && hash!== null && hash.match(/html$/)) {
} else {
  var newLocation = location.protocol+"//"+location.host+"#"+location.pathname;
  location.replace(newLocation);
}
</script>
<script type="text/javascript" src="/js/post-layout.js"></script>
<script>
$(document).ready(function () {
  makeSideBar('DOCUMENTATION-1.4.0', 'documentation/1.4.0/user_guide/services_management.md');
});
</script>

<script>
$("div[data-gist]").gist();
</script>
